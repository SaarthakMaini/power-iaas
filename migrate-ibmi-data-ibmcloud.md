---

copyright:
  years: 2020

lastupdated: "2020-07-29"

keywords: IBM i, Migrate, IBM Cloud

subcollection: power-iaas

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}
{:tip: .tip}
{:note: .note}
{:important: .important}
{:deprecated: .deprecated}
{:external: target="_blank" .external}

# Migrating IBM i Data to IBM Cloud
{: #migrating-ibmi-data-ibmcloud}

You can migrate the IBM i&reg; data to the IBM Cloud using an IBM Cloud Mass Data Migration device. The IBM i data is saved to virtual optical images in a Network File System (NFS) share located on the Mass Data Migration device at your data center. After you saved the data to virtual optical image, send the Mass Data Migration device back to IBM where your data will be moved to the IBM Cloud. You can accesse your data through IBM Cloud Object Storage.

## Prepare IBM Cloud for IBM i data
{: #prepare-ibmcloud-for-ibmidata}

You can set up your IBM Cloud Object Storage account for data migration and request a pre-configured storage device that can be used to move your data to IBM Cloud Object Storage. For More information, see [Getting started tutorial](/docs/mass-data-migration?topic=mass-data-migration-getting-started-tutorial).

## Prepare IBM Cloud Mass Data Migration device for IBM i data
{: #massdata-migrationdevice-for-ibmi-data}

After you receive the pre-configured storage device, see the [Mass Data Migration overview](/docs/mass-data-migration?topic=mass-data-migration-overview) and use the following checklist to complete the device setup.

1. [Connect the device](/docs/mass-data-migration?topic=mass-data-migration-connect-device)

2. [Log in to the device user interface](/docs/mass-data-migration?topic=mass-data-migration-access-ui)

3. [Unlock the storage pool for the device](/docs/mass-data-migration?topic=mass-data-migration-unlock-storage-pool)

4. See the [Managing access to the NFS share](/docs/mass-data-migration?topic=mass-data-migration-connect-nfs-share) topic to ensure the NFS shares are set up correctly for the IBM i. The directory (or a parent directory) which contains the virtual optical images must be shared with the following characteristics:

   * Share with the following Internet Protocol (IP) addresses:
     * IP address of the IBM i client.
     * IP address of the IBM i client service tools server or the LAN console connection if it is different from the system IP address. For more information, see [Configuring the service tools server for DST](https://www.ibm.com/support/knowledgecenter/ssw_ibm_i_74/rzamh/rzamhsrvtoolsrvr4dst.html).
   * Share for read and write.
    The IBM i IP address and the IBM i service tools server (LAN console connection) IP address can be the same.
    {: note}

## Prepare IBM i to use the Cloud Mass Data Migration device
{: #prepate-ibmi}

### Requirements:

To share virtual optical images with an IBM i client through an NFS server, the following requirements must be satisfied.

* The IBM i NFS client must have a version 4 IP address.
* The IBM i NFS client must have the NFS server share mounted over a local directory during the setup process.
* The IBM i NFS client must have a 632B-003 virtual optical device that uses the IP address of the NFS server.
* A directory under the NFS server share must contain images large enough to hold all the saved data for the IBM i client. The **Save** operations cannot dynamically create new images or extend the size of existing images, so understanding the size of the data generated by the save operation is important.
* A directory under the NFS server share must have a volume list file that contains a list of images to be used by an IBM i client. The volume list file must have the following characteristics:
  * The file must be in the same directory as the image files.
  * The file must be named VOLUME_LIST.
  * Each entry in the file is either an image file name with access intent or a comment.
  * Image file names are limited to 127 characters.
  * All characters following a hash symbol (#) are considered a comment and will be ignored.
  * The order of the image file names in the volume list file indicate the order the images will be processed on the IBM i client.
  * The file must contain ASCII characters.

### IBM i Network File System client set up
{: nfs-client-setup}

You can set up the IBM i client to use virtual optical images stored on an NFS server. The following example assumes that NFS server as *SERVER01* with IP address *'1.2.3.4'* has share */nfs/share01*

1. Create a mount directory for the NFS server.
    `MKDIR DIR('/NFS')`
    `MKDIR DIR('/NFS/SERVER01')`
2. Mount the NFS server root directory over the IBM i mount directory.
   `MOUNT TYPE(*NFS) MFS('1.2.3.4:/nfs/share01') MNTOVRDIR('/NFS/SERVER01')`
3. Create image information on the NFS server in the Portable Application Solutions Environment (PASE):
   i. Enter PASE.
       `CALL PGM(QP2TERM)`
   ii. Create a directory to contain the virtual image files.
       `mkdir /NFS/SERVER01/iImages`
   iii. Change to the virtual image file directory.
        `cd /NFS/SERVER01/iImages`

   iv. Create image files. The number of images and the size of the images cannot be changed during a *save* operation so they must be created large enough to hold all the save data. Following example creates three 10GB images. 
   Creating large files can take several minutes, do not exit PASE until each of the commands have sent a message that indicates it has completed.
   {: note}
      `dd if=/dev/zero of=IMAGE01.ISO bs=1M count=10000`
      `dd if=/dev/zero of=IMAGE02.ISO bs=1M count=10000`
      `dd if=/dev/zero of=IMAGE03.ISO bs=1M count=10000`

   v. Create volume list file **VOLUME_LIST**. The **W** at the end of each line indicates that image allows write access.
      `rm VOLUME_LIST`
      `echo 'IMAGE01.ISO W' >> VOLUME_LIST`
      `echo 'IMAGE02.ISO W' >> VOLUME_LIST`
      `echo 'IMAGE03.ISO W' >> VOLUME_LIST`

      * Verify the list.
        `cat VOLUME_LIST`
      * The cat output should show a line for each of the image file names with the corresponding access intent.
        `IMAGE01.ISO W`
        `IMAGE02.ISO W`
        `IMAGE03.ISO W`

   vi. Press F3 to exit the PASE.

4. Create a device description for a virtual optical device.
```
   CRTDEVOPT DEVD(NFSDEV01) RSRCNAME(*VRT) LCLINTNETA(*SRVLAN)
   RMTINTNETA('1.2.3.4') NETIMGDIR('/nfs/share01/iImages')
```

5. Vary on the virtual optical device. 
If the images or VOLUME_LIST file is changed on the NFS server, the virtual optical device must be varied off and then varied back on to use the virtual images.
{: note}
   `VRYCFG CFGOBJ(NFSDEV01) CFGTYPE(*DEV) STATUS(*ON)`

6. Use the device to initialize the image files as optical volumes.

```
   LODIMGCLGE IMGCLG(*DEV) IMGCLGIDX(3) DEV(NFSDEV01)
   INZOPT NEWVOL(IVOL03) DEV(NFSDEV01) CHECK(*NO)
   LODIMGCLGE IMGCLG(*DEV) IMGCLGIDX(2) DEV(NFSDEV01)
   INZOPT NEWVOL(IVOL02) DEV(NFSDEV01) CHECK(*NO)`
   LODIMGCLGE IMGCLG(*DEV) IMGCLGIDX(1) DEV(NFSDEV01) 
   INZOPT NEWVOL(IVOL01) DEV(NFSDEV01) CHECK(*NO)
```

7. Virtual device **NFSDEV01** can now be used for native IBM i *save* and *restore* operations. Volume *IVOL01* `(image file '/nfs/share01/iImages/IMAGE01.ISO')` is mounted on device **NFSDEV01**.

* To test the device, do the following to verify that a message queue can be saved and restored. Messages from the save and restore commands should indicate that one object was saved and one object was restored.

```
    CRTMSGQ MSGQ(QTEMP/MSGQ)
    SAVOBJ OBJ(MSGQ) LIB(QTEMP) DEV(NFSDEV01) CLEAR(*ALL)
    RSTOBJ OBJ(*ALL) SAVLIB(QTEMP) DEV(NFSDEV01)
```

* The save contents of the virtual optical volume can also be displayed:
   `DSPOPT VOL(IVOL01) DEV(NFSDEV01) DATA(*SAVRST) PATH(*ALL)`

## Save IBM i data to the Cloud Mass Data Migration device
{: #save-ibmidata-to-migrationdevice}

Save the data to the 632B OPT device through normal save mechanisms. If you are going to restore from a network install server you can use a *SAVSYS* command. If you want to restore from a local *IMGCLG*, then you have to create distribution media with go *LICPGM* option 40.

## Return the Cloud Mass Data Migration device to IBM
{: #return-migrationdeviceto-IBM}

Follow the [Returning the device](/docs/mass-data-migration?topic=mass-data-migration-return-device) process to complete the migration of IBM i data to your IBM Cloud Object Storage.




